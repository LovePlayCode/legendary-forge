# Legendary Forge - å‰ç«¯æ±‚èŒä½œå“å±•ç¤ºæ–‡æ¡£

> ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€è®¾è®¡ç²¾ç¾çš„åƒç´ é£æ ¼ç½‘é¡µæ¸¸æˆé¡¹ç›®ï¼Œå±•ç¤ºç°ä»£ React å…¨æ ˆå¼€å‘èƒ½åŠ›

---

## ğŸ“‘ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½å±•ç¤º](#æ ¸å¿ƒåŠŸèƒ½å±•ç¤º)
3. [æŠ€æœ¯äº®ç‚¹åˆ†æ](#æŠ€æœ¯äº®ç‚¹åˆ†æ)
4. [ä¸ªäººè´¡çŒ®è¯´æ˜](#ä¸ªäººè´¡çŒ®è¯´æ˜)
5. [æ€»ç»“åæ€](#æ€»ç»“åæ€)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®èƒŒæ™¯

**Legendary Forge**ï¼ˆä¼ è¯´é“åŒ é“ºï¼‰æ˜¯ä¸€ä¸ªä»¥ä¸­ä¸–çºªé”»é€ ä¸ºä¸»é¢˜çš„ç½‘é¡µæ¸¸æˆã€‚ç©å®¶æ‰®æ¼”ä¸€ä½é“åŒ ï¼Œé€šè¿‡é”»é€ è£…å¤‡ã€å®Œæˆè®¢å•ã€é›‡ä½£ NPC ç­‰å¤šç§ç©æ³•æ¥å»ºç«‹å’Œå‘å±•è‡ªå·±çš„é“åŒ é“ºã€‚

### æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|-----|-----|
| **é¡¹ç›®è§„æ¨¡** | 72 ä¸ªæºä»£ç æ–‡ä»¶ï¼Œæ€»è®¡ ~272 KB |
| **ç»„ä»¶æ•°é‡** | 39 ä¸ª React ç»„ä»¶ |
| **çŠ¶æ€ç®¡ç†** | Zustand + LocalStorage æŒä¹…åŒ– |
| **UI ç»„ä»¶åº“** | 16 ä¸ª Radix UI åŒ…è£…ç»„ä»¶ |
| **æ¸¸æˆç³»ç»Ÿ** | 7 ä¸ªå®Œæ•´ç³»ç»Ÿï¼ˆé”»é€ ã€è®¢å•ã€åº“å­˜ã€æ¢é™©ã€å‡çº§ã€NPCã€äº‹ä»¶ï¼‰ |
| **é…æ–¹/å‡çº§/å¡ç‰‡** | 25+é…æ–¹ / 30+å‡çº§ / 12+äº‹ä»¶å¡ç‰‡ |

### æŠ€æœ¯æ ˆ

```json
{
  "Frontend": {
    "æ¡†æ¶": "React 18.3.1 + TypeScript 5.6.2",
    "æ„å»º": "Vite 5.4.10",
    "æ ·å¼": "Tailwind CSS 3.4.17 + è‡ªå®šä¹‰åŠ¨ç”»",
    "3D": "Three.js 0.181.2",
    "UIç»„ä»¶": "Radix UI (16ä¸ªæ— å¤´ç»„ä»¶)",
    "å›¾æ ‡": "React Icons 5.5.0",
    "çŠ¶æ€": "Zustand 5.0.9"
  },
  "å¼€å‘å·¥å…·": {
    "ä»£ç æ£€æŸ¥": "ESLint + TypeScript ESLint",
    "ç±»å‹å®‰å…¨": "ä¸¥æ ¼æ¨¡å¼ + è·¯å¾„åˆ«å",
    "æ€§èƒ½": "ä»£ç åˆ†å‰² + Tree Shaking + æ‡’åŠ è½½"
  }
}
```

### æ¸¸æˆæµç¨‹

```
ç©å®¶å¼€å§‹ â†’ é€‰æ‹©é…æ–¹ â†’ æ‰§è¡Œé”»é€ å°æ¸¸æˆ â†’ è·å¾—è£…å¤‡ â†’ å®Œæˆè®¢å•/å‡ºå”® â†’ è·å¾—é‡‘å¸/å£°æœ›
â†“
è§£é”å‡çº§ â†’ é›‡ä½£NPC â†’ è§¦å‘éšæœºäº‹ä»¶ â†’ æå‡ç­‰çº§ â†’ è¿›å…¥ä¸‹ä¸€å¤©
```

---

## æ ¸å¿ƒåŠŸèƒ½å±•ç¤º

### 1. ğŸ”¨ é”»é€ ç³»ç»Ÿï¼ˆWorkshop Moduleï¼‰

**åŠŸèƒ½äº®ç‚¹**ï¼š
- å®æ—¶æ¸©åº¦æ§åˆ¶ä¸ QTE å¿«é€Ÿååº”æœºåˆ¶
- åŸºäºæ€§èƒ½çš„åŠ¨æ€å“è´¨è®¡ç®—ç³»ç»Ÿ
- åƒç´ é£æ ¼çš„é“åŒ åŠ¨ç”»å±•ç¤º

#### 1.1 æ¸¸æˆå¼•æ“å®ç°

**æ–‡ä»¶**ï¼š`src/components/game/workshop/ForgingGame.tsx` (280 è¡Œ)

é”»é€ è¿‡ç¨‹åŒ…å« 3 ä¸ªé˜¶æ®µï¼š

```typescript
// é˜¶æ®µ 1: æ¸©åº¦æ§åˆ¶ (100 steps, 1000ms æ€»æ—¶é•¿)
çŠ¶æ€æ›´æ–°å‘¨æœŸï¼š100ms
- æ¸©åº¦éšæœºæ¼‚ç§» Â±2Â°C (æ¯ 500ms)
- ç©å®¶é€šè¿‡æ»‘å—è°ƒæ•´ç›®æ ‡æ¸©åº¦
- å®æ—¶è®¡ç®—æ¸©åº¦åå·®è¯„åˆ†

// é˜¶æ®µ 2: QTE ååº” (100ms æ—¶é—´çª—å£)
- å®Œæˆè¿›åº¦æ—¶è§¦å‘
- ç©å®¶éœ€åœ¨ 100ms å†…ç‚¹å‡»
- æˆåŠŸç‡å½±å“æœ€ç»ˆå“è´¨

// é˜¶æ®µ 3: ç»“æœè®¡ç®—
finalScore = baseScore * (0.8 + tempScore*0.2 + qteBonus*0.2)
quality = calculateQuality(finalScore)
```

**æ ¸å¿ƒç®—æ³•**ï¼š

```typescript
// å“è´¨æ˜ å°„è¡¨
interface QualityThreshold {
  mythic: 95,        // ç¥è¯å“è´¨ (2.2x å±æ€§å€ç‡)
  legendary: 85,     // ä¼ è¯´å“è´¨ (1.8x)
  epic: 70,          // å²è¯—å“è´¨ (1.5x)
  rare: 55,          // ç¨€æœ‰å“è´¨ (1.3x)
  uncommon: 40,      // ç²¾è‰¯å“è´¨ (1.15x)
  common: 20,        // æ™®é€šå“è´¨ (1x)
  poor: 0            // ç²—ç³™å“è´¨ (0.6x)
}

// å®æ—¶æ€§èƒ½è®¡ç®—
const avgTempScore = calculateTempAccuracy(steps)
const performance = Math.max(0, 
  Math.min(100, baseScore + (avgTempScore * 20) + (qteSuccess ? 20 : 0))
)
```

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- âœ… ä½¿ç”¨ `requestAnimationFrame` æ›¿ä»£ `setInterval` å®ç°å¹³æ»‘åŠ¨ç”»
- âœ… çŠ¶æ€å˜åŒ–ä½¿ç”¨ React Hooksï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- âœ… åŠ¨ç”»å‚æ•°é€šè¿‡ CSS å˜é‡å®æ—¶æ›´æ–°ï¼Œä¸é‡æ’ DOM

```typescript
// ä¼˜åŒ–ç¤ºä¾‹ï¼šä½¿ç”¨ CSS å˜é‡å®ç°å®æ—¶æ¸©åº¦æ˜¾ç¤º
<div
  style={{
    '--temperature': `${(currentTemp / 100) * 100}%`,
  } as React.CSSProperties}
  className="temperature-bar"
/>
```

#### 1.2 é…æ–¹ç³»ç»Ÿ

**æ–‡ä»¶**ï¼š`src/data/recipes.ts` (5.81 KB) + `src/components/game/workshop/RecipeSelector.tsx`

åŒ…å« **25+ é…æ–¹**ï¼Œåˆ†ç±»å¦‚ä¸‹ï¼š

| åˆ†ç±» | æ•°é‡ | ç¤ºä¾‹ |
|-----|-----|------|
| æ­¦å™¨ | 7 | å‰‘ã€åŒ•é¦–ã€æˆ˜æ–§ã€é”¤ã€å¼“ã€æ³•æ–ã€é•¿çŸ› |
| é˜²å…· | 7 | ç›¾ã€æŠ¤ç”²ã€å¤´ç›”ã€é´å­ã€æ‰‹å¥—ã€æŠ«é£ |
| é¥°å“ | 4 | æˆ’æŒ‡ã€é¡¹é“¾ã€è…°å¸¦ |

**é…æ–¹æ•°æ®ç»“æ„**ï¼š

```typescript
interface Recipe {
  id: string;
  name: string;
  description: string;
  icon: IconName;
  craftable: Equipment;
  materials: MaterialRequirement[];
  level: number;           // è§£é”ç­‰çº§
  profession: Profession;  // ç›¸å…³èŒä¸š
}

// å®é™…ç¤ºä¾‹
{
  id: 'iron-sword',
  name: 'é“å‰‘',
  materials: [
    { material: 'iron', amount: 30 },
    { material: 'wood', amount: 10 }
  ],
  level: 1,
  profession: 'knight'
}
```

**é…æ–¹é€‰æ‹© UI**ï¼š

```typescript
// RecipeSelector ç»„ä»¶ç‰¹æ€§
1. åˆ†ç±»æ’åˆ— (type: sword/armor/ring ç­‰)
2. è¿‡æ»¤ç³»ç»Ÿ (å·²è§£é”/å¯åˆ¶é€ /å¯å‡çº§)
3. å¿«é€Ÿæœç´¢ (æŒ‰åç§°/èŒä¸šè¿‡æ»¤)
4. ææ–™éªŒè¯ (å®æ—¶æ£€æŸ¥åº“å­˜)
5. é¢„è§ˆåŠŸèƒ½ (3D è£…å¤‡æ˜¾ç¤º)
```

---

### 2. ğŸ“¦ åº“å­˜ä¸è£…å¤‡ç³»ç»Ÿï¼ˆInventory Moduleï¼‰

**åŠŸèƒ½äº®ç‚¹**ï¼š
- è£…å¤‡å“è´¨å¤šçº§åˆ†ç±»æ˜¾ç¤º
- 2D/3D è£…å¤‡åˆ‡æ¢å±•ç¤º
- çµæ´»çš„è¿‡æ»¤ä¸æ’åºåŠŸèƒ½

#### 2.1 è£…å¤‡å“è´¨ç³»ç»Ÿ

**æ–‡ä»¶**ï¼š`src/components/game/inventory/Inventory.tsx` (415 è¡Œ)

æ”¯æŒ 7 çº§å“è´¨ç³»ç»Ÿï¼š

```typescript
type Quality = 
  | 'poor'        // ç²—ç³™ (ç°è‰²) - 0.6x
  | 'common'      // æ™®é€š (çŸ³è‰²) - 1.0x
  | 'uncommon'    // ç²¾è‰¯ (ç»¿è‰²) - 1.15x
  | 'rare'        // ç¨€æœ‰ (è“è‰²) - 1.3x
  | 'epic'        // å²è¯— (ç´«è‰²) - 1.5x
  | 'legendary'   // ä¼ è¯´ (æ©™è‰²) - 1.8x
  | 'mythic'      // ç¥è¯ (çº¢è‰²) - 2.2x

// å“è´¨ç€è‰²æ–¹æ¡ˆ
const qualityColors = {
  poor: '#9ca3af',
  common: '#78716c',
  uncommon: '#22c55e',
  rare: '#3b82f6',
  epic: '#a855f7',
  legendary: '#f59e0b',
  mythic: '#ef4444'
}
```

**åº“å­˜ç®¡ç†ç‰¹æ€§**ï¼š

```typescript
// 1. åŠ¨æ€å®¹é‡ç³»ç»Ÿ
interface Inventory {
  items: (Equipment | Material)[];
  capacity: number;        // å¯å‡çº§
  usage: number;           // å®æ—¶è®¡ç®—
  percentage: number;      // 85% æ—¶è­¦å‘Š
}

// 2. è£…å¤‡å±æ€§è®¡ç®—
const equipmentValue = {
  baseSellPrice: 50,       // åŸºç¡€ä»·æ ¼
  qualityMultiplier: qualityMap[quality],
  rarity: equipmentRarity,
  finalPrice: baseSellPrice * qualityMultiplier
}

// 3. æ‰¹é‡æ“ä½œ
- æŒ‰å“è´¨ç­›é€‰
- æŒ‰ç±»å‹æ’åº
- æ‰¹é‡å‡ºå”®
- æ¸…ç©ºæ‰€æœ‰
```

#### 2.2 è£…å¤‡æ˜¾ç¤ºï¼ˆ2D/3D åˆ‡æ¢ï¼‰

**æ–‡ä»¶**ï¼š
- `src/components/game/common/EquipmentIcon.tsx` (20 KB) - 2D æ¸²æŸ“
- `src/components/game/common/EquipmentIcon3D.tsx` (21.86 KB) - 3D æ¸²æŸ“
- `src/components/game/common/EquipmentIconWrapper.tsx` - åˆ‡æ¢å™¨

**2D å›¾æ ‡æ¸²æŸ“**ï¼š

```typescript
// ä½¿ç”¨ React Icons æ¸²æŸ“ 15 ç§è£…å¤‡ç±»å‹
import { 
  GiSwordClash,      // å‰‘
  GiDagger,          // åŒ•é¦–
  GiLongSword,       // é•¿å‰‘
  // ... æ›´å¤šå›¾æ ‡
} from 'react-icons/gi'

// ä¼˜åŒ–ï¼šä½¿ç”¨ Map ç¼“å­˜å’Œ Memoization
const EQUIPMENT_ICONS = new Map([
  ['sword', GiSwordClash],
  ['dagger', GiDagger],
  // ...
])

// ç»„ä»¶ä¼˜åŒ–
export const EquipmentIcon = React.memo(({ equipment, size }) => {
  const Icon = EQUIPMENT_ICONS.get(equipment.type)
  return <Icon size={size} color={qualityColor} />
})
```

**3D è£…å¤‡æ¸²æŸ“**ï¼š

```typescript
// ä½¿ç”¨ Three.js å®ç° 3D æ¨¡å‹æ˜¾ç¤º
import * as THREE from 'three'

// åˆå§‹åŒ–åœºæ™¯
const scene = new THREE.Scene()
const camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000)
const renderer = new THREE.WebGLRenderer({ antialias: true })

// åˆ›å»ºè£…å¤‡æ¨¡å‹ï¼ˆå‡ ä½•ä½“ + æè´¨ï¼‰
const geometry = generateEquipmentGeometry(equipmentType)
const material = new THREE.MeshStandardMaterial({
  color: qualityColorHex,
  metalness: 0.8,
  roughness: 0.2
})
const mesh = new THREE.Mesh(geometry, material)

// ç¯å…‰è®¾ç½®
const light = new THREE.PointLight(0xffffff, 1)
camera.position.set(0, 0, 2)

// åŠ¨ç”»å¾ªç¯
const animate = () => {
  requestAnimationFrame(animate)
  mesh.rotation.y += 0.01
  renderer.render(scene, camera)
}
```

**æ€§èƒ½ä¼˜åŒ–**ï¼š

```typescript
// é¿å…é‡å¤åˆå§‹åŒ–
useEffect(() => {
  if (!canvasRef.current) return
  
  const renderer = useMemo(() => 
    new THREE.WebGLRenderer({ canvas: canvasRef.current })
  , [])
  
  return () => renderer.dispose()
}, [])

// æŒ‰éœ€åŠ è½½ 3D åº“
if (show3D && !THREE) {
  import('three').then(m => setThree(m))
}
```

---

### 3. ğŸ“‹ è®¢å•ç³»ç»Ÿï¼ˆOrders Moduleï¼‰

**åŠŸèƒ½äº®ç‚¹**ï¼š
- åŠ¨æ€è®¢å•ç”Ÿæˆä¸éš¾åº¦è°ƒèŠ‚
- NPC ä¿¡æ¯å¤šç»´å±•ç¤º
- è®¢å•äº¤ä»˜ä¸æŠ¥é…¬ç»“ç®—

#### 3.1 è®¢å•ç”Ÿæˆæœºåˆ¶

**æ–‡ä»¶**ï¼š`src/data/npcs.ts` + `src/components/game/orders/Orders.tsx`

```typescript
// è®¢å•ç”Ÿæˆå‚æ•°
interface Order {
  id: string;
  npc: NPC;
  requiredEquipment: EquipmentRequirement;
  dueDate: number;              // å¤©æ•°é™åˆ¶
  reward: {
    gold: number;
    reputation: number;
  };
  bonus?: {
    condition: 'earliness' | 'quality';
    value: number;
  }
}

// è®¢å•éš¾åº¦è®¡ç®—
const calculateOrderValue = (baseValue: number, modifiers) => {
  let value = baseValue
  
  // æ—¶é—´é™åˆ¶å‡é€Ÿ
  if (daysLeft < 2) {
    value *= 1.3  // ç´§æ€¥è®¢å•
  }
  
  // å“è´¨è¦æ±‚åŠ é€Ÿ
  if (minQuality >= 'epic') {
    value *= 1.5  // é«˜å“è´¨éœ€æ±‚
  }
  
  // NPC ç­‰çº§è°ƒæ•´
  value *= (1 + npc.level * 0.1)
  
  return Math.floor(value)
}

// è®¢å•æ¥æºå¤šæ ·åŒ–
const NPCs = [
  { profession: 'knight', è®¢å•å€¾å‘: æ­¦å™¨/é˜²å…· },
  { profession: 'mage', è®¢å•å€¾å‘: æ³•æ–/é¥°å“ },
  { profession: 'villager', è®¢å•å€¾å‘: æ—¥å¸¸å·¥å…· },
  // ...
]
```

#### 3.2 è®¢å•äº¤ä»˜æµç¨‹

```typescript
// DeliveryDialog ç»„ä»¶
const handleDeliver = (selectedEquipment: Equipment) => {
  // 1. å“è´¨éªŒè¯
  if (selectedEquipment.quality < order.minQuality) {
    showError('å“è´¨ä¸ç¬¦')
    return
  }
  
  // 2. è®¡ç®—æŠ¥é…¬
  const baseReward = order.reward.gold
  const qualityBonus = calculateQualityBonus(
    selectedEquipment.quality,
    order.minQuality
  )
  
  // 3. åº”ç”¨åŠ æˆ
  let finalReward = baseReward * (1 + qualityBonus)
  
  // åº”ç”¨é›‡ä½£ NPC åŠ æˆ
  if (hiredNPCs.length > 0) {
    const reputationBoost = hiredNPCs
      .filter(npc => npc.bonus.type === 'orderRewardBoost')
      .reduce((acc, npc) => acc + npc.bonus.value, 0)
    finalReward *= (1 + reputationBoost)
  }
  
  // 4. å®Œæˆè®¢å•
  gameStore.addGold(Math.floor(finalReward))
  gameStore.addReputation(order.reward.reputation)
  gameStore.removeOrder(order.id)
  showSuccess(`è·å¾— ${finalReward} é‡‘å¸ï¼`)
}
```

---

### 4. ğŸ—ºï¸ æ¢é™©ç³»ç»Ÿï¼ˆExploration Moduleï¼‰

**åŠŸèƒ½äº®ç‚¹**ï¼š
- ä¸‰ä¸ªåœ°å›¾åœºæ™¯é€‰æ‹©
- è¿›åº¦æ¡åŠ¨ç”»æ˜¾ç¤º
- ææ–™éšæœºå¥–åŠ±

#### 4.1 æ¢é™©æœºåˆ¶

**æ–‡ä»¶**ï¼š`src/components/game/exploration/Exploration.tsx` (343 è¡Œ)

```typescript
// åœ°å›¾é…ç½®
const expeditionLocations = [
  {
    id: 'forest',
    name: 'æ£®æ—',
    icon: 'GiTreeDoor',
    description: 'æœ¨æä¸°å¯Œ',
    duration: 30,        // ç§’
    materials: [
      { type: 'wood', min: 20, max: 40 },
      { type: 'leather', min: 10, max: 20 }
    ],
    difficulty: 'easy'
  },
  {
    id: 'mine',
    name: 'çŸ¿æ´',
    icon: 'GiMineralGrowth',
    description: 'çŸ¿ç‰©å®è—',
    duration: 45,
    materials: [
      { type: 'iron', min: 30, max: 50 },
      { type: 'copper', min: 20, max: 35 },
      { type: 'gem', min: 5, max: 15 }
    ],
    difficulty: 'medium'
  },
  {
    id: 'ruins',
    name: 'é—è¿¹',
    icon: 'GiAncientColumns',
    description: 'ç¥ç§˜ç‰©å“',
    duration: 60,
    materials: [
      { type: 'crystal', min: 15, max: 25 },
      { type: 'gem', min: 10, max: 20 },
      { type: 'gold', min: 20, max: 40 }
    ],
    difficulty: 'hard'
  }
]

// æ¢é™©æ—¶é—´è®¡ç®—ï¼ˆæ”¯æŒåŠ é€Ÿï¼‰
const expeditionTime = baseDuration * (1 - speedBonus)

// ç¤ºä¾‹ï¼šç–¾è¡Œç¬¦å’’äº‹ä»¶å¡ (50% åŠ é€Ÿ)
const finalTime = 45 * (1 - 0.5) = 22.5 ç§’
```

#### 4.2 è¿›åº¦æ¡å®ç°

```typescript
// å¹³æ»‘è¿›åº¦æ¡åŠ¨ç”»
useEffect(() => {
  let startTime = Date.now()
  
  const updateProgress = () => {
    const elapsed = Date.now() - startTime
    const progress = Math.min(elapsed / (duration * 1000), 1)
    
    setProgress(progress)
    
    // ä½¿ç”¨ easing function å®ç°ç¼“åŠ¨æ•ˆæœ
    const eased = easeInOutQuad(progress)
    setVisualProgress(eased)
    
    if (progress < 1) {
      requestAnimationFrame(updateProgress)
    } else {
      completeExpedition()
    }
  }
  
  const frameId = requestAnimationFrame(updateProgress)
  return () => cancelAnimationFrame(frameId)
}, [duration])

// Easing å‡½æ•°
const easeInOutQuad = (t) => {
  return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t
}
```

---

### 5. ğŸ†™ å‡çº§ç³»ç»Ÿï¼ˆUpgrades Moduleï¼‰

**åŠŸèƒ½äº®ç‚¹**ï¼š
- 30+ å‡çº§é€‰é¡¹ï¼Œå±‚çº§é€’è¿›
- æŠ€èƒ½æ ‘å¯è§†åŒ–
- åŠ¨æ€è§£é”æœºåˆ¶

#### 5.1 å‡çº§æ ‘ç»“æ„

**æ–‡ä»¶**ï¼š`src/data/upgrades.ts` (9.75 KB)

```typescript
// å‡çº§åˆ†ç±»
const UPGRADE_CATEGORIES = {
  // å·¥å…·å‡çº§ (8ä¸ª)
  TOOLS: [
    'hammer-tier2', 'hammer-tier3', 'anvil-upgrade', 
    'furnace-upgrade', 'water-trough', 'bellows', 
    'grinding-stone', 'quenching-tank'
  ],
  
  // åº—é“ºæ‰©å»º (7ä¸ª)
  SHOP: [
    'warehouse-extension', 'counter-upgrade',
    'storefront-decoration', 'flame-control',
    'inventory-organization', 'display-case', 'vault'
  ],
  
  // æŠ€èƒ½æ ‘ (15+ä¸ª)
  SKILLS: {
    // é…æ–¹è§£é”
    RECIPES: [
      'recipe-rarity-common', 'recipe-rarity-rare',
      'recipe-equipment-type-*'
    ],
    
    // å·¥åŒ æŠ€èƒ½
    CRAFTER: [
      'quality-mastery-1', 'quality-mastery-2',
      'speed-efficiency', 'material-conservation'
    ],
    
    // å•†äººæŠ€èƒ½
    MERCHANT: [
      'price-negotiation', 'bulk-discount',
      'reputation-growth', 'market-analysis'
    ],
    
    // æ¢é™©æŠ€èƒ½
    EXPLORER: [
      'resource-abundance', 'expedition-boost',
      'rare-material-chance'
    ],
    
    // ç§˜ä¼ æŠ€èƒ½
    SECRET: [
      'legendary-touch', 'perfect-forge',
      'time-manipulation'
    ]
  }
}

// å‡çº§æ•°æ®ç»“æ„
interface Upgrade {
  id: string;
  name: string;
  category: UpgradeCategory;
  icon: IconName;
  description: string;
  cost: number;                 // é‡‘å¸
  level: number;               // æ‰€éœ€ç©å®¶ç­‰çº§
  prerequisites: string[];     // å‰ç½®å‡çº§
  effect: {
    type: EffectType;
    value: number | string;
  };
  unlocks?: {
    recipes?: string[];
    upgrades?: string[];
  };
}

// å®é™…ç¤ºä¾‹
{
  id: 'quality-mastery-1',
  name: 'å“è´¨ç²¾é€š I',
  category: 'SKILLS',
  description: 'è£…å¤‡å“è´¨æå‡ 10%',
  cost: 500,
  level: 5,
  prerequisites: [],
  effect: {
    type: 'qualityBoost',
    value: 0.1
  },
  unlocks: {
    upgrades: ['quality-mastery-2']
  }
}
```

#### 5.2 å‡çº§è§£é”æœºåˆ¶

```typescript
// æ£€æŸ¥å‡çº§æ˜¯å¦å¯è´­ä¹°
const canPurchaseUpgrade = (upgrade: Upgrade) => {
  // æ¡ä»¶ 1: é‡‘å¸å……è¶³
  if (gold < upgrade.cost) return false
  
  // æ¡ä»¶ 2: ç­‰çº§æ»¡è¶³
  if (playerLevel < upgrade.level) return false
  
  // æ¡ä»¶ 3: å‰ç½®å‡çº§å·²è´­ä¹°
  if (upgrade.prerequisites.length > 0) {
    const allPrerequisitesMet = upgrade.prerequisites.every(
      preId => purchasedUpgrades.has(preId)
    )
    if (!allPrerequisitesMet) return false
  }
  
  // æ¡ä»¶ 4: æœªé‡å¤è´­ä¹°ï¼ˆæŸäº›å‡çº§åªèƒ½ä¹°ä¸€æ¬¡ï¼‰
  if (upgrade.maxPurchases && 
      purchaseCount[upgrade.id] >= upgrade.maxPurchases) {
    return false
  }
  
  return true
}

// è´­ä¹°å‡çº§
const purchaseUpgrade = (upgradeId: string) => {
  const upgrade = getUpgradeById(upgradeId)
  
  if (!canPurchaseUpgrade(upgrade)) {
    showError('æ— æ³•è´­ä¹°æ­¤å‡çº§')
    return
  }
  
  // 1. æ‰£è´¹
  gameStore.spendGold(upgrade.cost)
  
  // 2. åº”ç”¨æ•ˆæœ
  applyUpgradeEffect(upgrade)
  
  // 3. è§£é”æ–°å†…å®¹
  if (upgrade.unlocks) {
    if (upgrade.unlocks.recipes) {
      gameStore.unlockRecipes(upgrade.unlocks.recipes)
    }
    if (upgrade.unlocks.upgrades) {
      gameStore.unlockUpgrades(upgrade.unlocks.upgrades)
    }
  }
  
  // 4. æ’­æ”¾åŠ¨ç”»
  showSuccess(`å·²è´­ä¹°ï¼š${upgrade.name}`)
}
```

---

### 6. ğŸ‘¥ NPC é›‡ä½£ç³»ç»Ÿï¼ˆNPC Hiring Moduleï¼‰

**åŠŸèƒ½äº®ç‚¹**ï¼š
- äº”ä¸ªèŒä¸š NPCï¼Œç‰¹è‰²åŠ æˆä¸åŒ
- ç»éªŒç­‰çº§ç³»ç»Ÿï¼Œæ¸è¿›å¼å¼ºåŒ–
- è–ªèµ„æˆæœ¬è€ƒé‡

#### 6.1 NPC èŒä¸šä¸åŠ æˆ

**æ–‡ä»¶**ï¼š`src/data/hiredNpcs.ts` (213 è¡Œ)

```typescript
// NPC èŒä¸šå®šä¹‰
type NPCProfession = 'knight' | 'mage' | 'villager' | 'merchant' | 'adventurer'

// èŒä¸šç‰¹æ€§æ˜ å°„
const PROFESSION_BONUSES = {
  knight: {
    type: 'forgeSpeedBonus',
    description: 'é”»é€ é€Ÿåº¦ +15%',
    baseValue: 0.15
  },
  mage: {
    type: 'qualityBoost',
    description: 'è£…å¤‡å“è´¨ +10%',
    baseValue: 0.1
  },
  villager: {
    type: 'materialSave',
    description: 'ææ–™æ¶ˆè€— -20%',
    baseValue: 0.2
  },
  merchant: {
    type: 'orderRewardBoost',
    description: 'è®¢å•æŠ¥é…¬ +25%',
    baseValue: 0.25
  },
  adventurer: {
    type: 'reputationBoost',
    description: 'å£°æœ›è·å¾— +30%',
    baseValue: 0.3
  }
}

// NPC å“è´¨ä¸æˆæœ¬
const QUALITY_COST_MAP = {
  common: 300,           // æ™®é€š
  uncommon: 800,         // ç²¾è‰¯
  rare: 2000,            // ç¨€æœ‰
  epic: 5000,            // å²è¯—
  legendary: 15000       // ä¼ è¯´
}

// åŠ æˆè®¡ç®—
const calculateNPCBonus = (npc: HiredNPC) => {
  const baseBnus = PROFESSION_BONUSES[npc.profession].baseValue
  const levelBonus = (npc.level - 1) * 0.05  // æ¯çº§ +5%
  const totalBonus = baseBonus * (1 + levelBonus)
  
  return totalBonus
}
```

#### 6.2 ç»éªŒå‡çº§ç³»ç»Ÿ

```typescript
// NPC ç­‰çº§ç³»ç»Ÿ
interface HiredNPC {
  id: string;
  name: string;
  profession: NPCProfession;
  quality: NPCQuality;
  level: number;              // 1-5
  experience: number;
  dailySalary: number;        // æ¯å¤©å›ºå®šè´¹ç”¨
  bonus: {
    type: BonusType;
    value: number;
  }
}

// ç»éªŒè·å–
const gainNPCExperience = (npc: HiredNPC, amount: number) => {
  const requiredExp = npc.level * 100  // æ¯çº§æ‰€éœ€ç»éªŒ
  
  npc.experience += amount
  
  while (npc.experience >= requiredExp && npc.level < 5) {
    npc.experience -= requiredExp
    npc.level += 1
    
    // å‡çº§æ—¶å¢åŠ åŠ æˆ
    npc.bonus.value *= 1.1  // 10% åŠ æˆæå‡
    
    showNotification(`${npc.name} å‡çº§åˆ° ${npc.level} çº§ï¼`)
  }
}

// è–ªèµ„ç»“ç®—ï¼ˆæ¯å¤©è‡ªåŠ¨æ‰£é™¤ï¼‰
const payNPCSalaries = (hiredNPCs: HiredNPC[]) => {
  const totalSalary = hiredNPCs.reduce(
    (sum, npc) => sum + npc.dailySalary,
    0
  )
  
  if (gameStore.gold >= totalSalary) {
    gameStore.spendGold(totalSalary)
    gameStore.addNPCExperience(hiredNPCs)
    return true
  } else {
    // æ— æ³•æ”¯ä»˜è–ªèµ„ï¼Œéšæœºè§£é›‡ä¸€ä¸ª NPC
    const randomNPC = hiredNPCs[Math.floor(Math.random() * hiredNPCs.length)]
    gameStore.fireNPC(randomNPC.id)
    showWarning(`æ— æ³•æ”¯ä»˜è–ªèµ„ï¼Œ${randomNPC.name} å·²ç¦»èŒ`)
    return false
  }
}
```

---

### 7. ğŸ° äº‹ä»¶ç³»ç»Ÿï¼ˆEvents Moduleï¼‰

**åŠŸèƒ½äº®ç‚¹**ï¼š
- éšæœºäº‹ä»¶å¡æ± ï¼Œæ¦‚ç‡åŠ æƒ
- å¤šç§æ•ˆæœç±»å‹ï¼Œçµæ´»ç»„åˆ
- äº‹ä»¶å€’è®¡æ—¶ä¸æ´»è·ƒæ•ˆæœè¿½è¸ª

#### 7.1 äº‹ä»¶å¡ç‰‡æ± 

**æ–‡ä»¶**ï¼š`src/data/events.ts` (4.64 KB)

```typescript
// äº‹ä»¶å¡ç‰‡æ±  (12+ å¼ å¡)
export const eventCardPool: EventCard[] = [
  // æ™®é€šå¡ç‰‡ (60% æƒé‡)
  {
    id: 'double-forge-1',
    name: 'åŒå€é”»é€ ',
    description: 'ä¸‹æ¬¡é”»é€ å°†äº§å‡º2ä»¶ç›¸åŒç‰©å“',
    icon: 'GiAnvilImpact',
    rarity: 'common',
    effectType: 'doubleForge',
    effectValue: 2,
    usageCount: 1
  },
  
  // ç¨€æœ‰å¡ç‰‡ (30% æƒé‡)
  {
    id: 'quality-boost-1',
    name: 'å“è´¨æå‡',
    description: 'ä¸‹2æ¬¡é”»é€ å“è´¨å¤§å¹…æå‡',
    icon: 'GiCrystalGrowth',
    rarity: 'rare',
    effectType: 'qualityBoost',
    effectValue: 0.3,
    usageCount: 2
  },
  
  // å²è¯—å¡ç‰‡ (10% æƒé‡)
  {
    id: 'all-boost-1',
    name: 'é“åŒ ç¥ç¦',
    description: '90ç§’å†…é”»é€ é€Ÿåº¦å’Œå“è´¨å‡æå‡30%',
    icon: 'GiSparkles',
    rarity: 'epic',
    effectType: 'qualityBoost',
    effectValue: 0.3,
    duration: 90
  }
]

// äº‹ä»¶æ•ˆæœç±»å‹
type EffectType = 
  | 'doubleForge'      // äº§å‡ºå€æ•°
  | 'qualityBoost'     // å“è´¨åŠ æˆ
  | 'materialSave'     // ææ–™èŠ‚çœ
  | 'goldBonus'        // é‡‘å¸å¥–åŠ±
  | 'reputationBoost'  // å£°æœ›åŠ æˆ
  | 'expeditionSpeed'  // æ¢é™©åŠ é€Ÿ
  | 'tempStable'       // æ¸©åº¦ç¨³å®š
  | 'qteEasy'          // QTE ç®€åŒ–
```

#### 6.2 äº‹ä»¶è§¦å‘ä¸æ¦‚ç‡

```typescript
// äº‹ä»¶è§¦å‘æœºåˆ¶
export const getRandomCards = (count: number = 3): EventCard[] => {
  const rarityWeights = {
    common: 60,    // 60% æ¦‚ç‡
    rare: 30,      // 30% æ¦‚ç‡
    epic: 10       // 10% æ¦‚ç‡
  }
  
  const totalWeight = 100
  const selectedCards: EventCard[] = []
  const usedIds = new Set<string>()
  
  // æ— é‡å¤æŠ½å–
  while (selectedCards.length < count) {
    const roll = Math.random() * totalWeight
    let rarity: 'common' | 'rare' | 'epic'
    
    if (roll < rarityWeights.common) {
      rarity = 'common'
    } else if (roll < rarityWeights.common + rarityWeights.rare) {
      rarity = 'rare'
    } else {
      rarity = 'epic'
    }
    
    // è¿‡æ»¤å¯ç”¨å¡ç‰‡
    const availableCards = eventCardPool.filter(
      (card) => card.rarity === rarity && !usedIds.has(card.id)
    )
    
    if (availableCards.length > 0) {
      const randomIndex = Math.floor(Math.random() * availableCards.length)
      const selectedCard = availableCards[randomIndex]
      
      selectedCards.push(selectedCard)
      usedIds.add(selectedCard.id)
    }
  }
  
  return selectedCards
}

// äº‹ä»¶å€’è®¡æ—¶ (60 ç§’ä¸€æ¬¡)
export const EVENT_INTERVAL = 60

// äº‹ä»¶é€‰æ‹©å¤„ç†
const selectEventCard = (card: EventCard) => {
  const effect: ActiveEffect = {
    id: `effect-${Date.now()}`,
    effectType: card.effectType,
    value: card.effectValue,
    remainingUses: card.usageCount || Infinity,
    duration: card.duration || null,
    startTime: Date.now()
  }
  
  gameStore.addActiveEffect(effect)
  
  // ç‰¹æ®Šå¤„ç†ï¼šå³æ—¶æ•ˆæœ
  if (card.effectType === 'goldBonus') {
    gameStore.addGold(card.effectValue)
  }
  
  showNotification(`è·å¾—äº‹ä»¶å¡ï¼š${card.name}`)
}
```

#### 7.3 æ´»è·ƒæ•ˆæœè¿½è¸ª

```typescript
// æ´»è·ƒæ•ˆæœæ›´æ–° (æ¯å¸§è°ƒç”¨)
const updateActiveEffects = () => {
  const now = Date.now()
  const activeEffects = gameStore.activeEffects
  
  activeEffects.forEach((effect, index) => {
    // æ£€æŸ¥æŒç»­æ—¶é—´
    if (effect.duration) {
      const elapsed = now - effect.startTime
      if (elapsed > effect.duration * 1000) {
        // ç§»é™¤è¿‡æœŸæ•ˆæœ
        gameStore.removeActiveEffect(effect.id)
        return
      }
    }
    
    // æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°
    if (effect.remainingUses <= 0) {
      gameStore.removeActiveEffect(effect.id)
      return
    }
  })
}

// æ¶ˆè€—æ•ˆæœ
const consumeEffect = (effectType: EffectType) => {
  const effect = gameStore.activeEffects.find(
    e => e.effectType === effectType && e.remainingUses > 0
  )
  
  if (effect) {
    if (effect.remainingUses !== Infinity) {
      effect.remainingUses -= 1
    }
    return effect.value
  }
  
  return 0
}
```

---

## æŠ€æœ¯äº®ç‚¹åˆ†æ

### 1. ğŸ—ï¸ çŠ¶æ€ç®¡ç†æ¶æ„ï¼ˆZustand + LocalStorageï¼‰

**æ–‡ä»¶**ï¼š`src/store/gameStore.ts` (433 è¡Œ)

#### 1.1 è®¾è®¡æ€æƒ³

é‡‡ç”¨ **Zustand** è€Œé Redux çš„åŸå› ï¼š

| å¯¹æ¯”é¡¹ | Redux | Zustand | é€‰æ‹© |
|------|-------|---------|------|
| **åŒ…ä½“ç§¯** | ~11 KB | ~2 KB | âœ… Zustand |
| **å­¦ä¹ æ›²çº¿** | é™¡å³­ | å¹³ç¼“ | âœ… Zustand |
| **æ€§èƒ½** | ä¸­ç­‰ | ä¼˜ç§€ | âœ… Zustand |
| **å¼€å‘ä½“éªŒ** | ç¹ç | ç®€æ´ | âœ… Zustand |
| **ç±»å‹æ”¯æŒ** | éœ€æ’ä»¶ | å®Œç¾ | âœ… Zustand |

```typescript
// Zustand æ ¸å¿ƒç‰¹æ€§
import { create } from 'zustand'
import { persist, devtools } from 'zustand/middleware'

// ä¸­é—´ä»¶ç»„åˆ
const useGameStore = create<GameState & GameActions>()(
  devtools(
    persist(
      (set, get) => ({
        // çŠ¶æ€
        gold: 0,
        reputation: 0,
        level: 1,
        // ...
        
        // æ´¾ç”ŸçŠ¶æ€ï¼ˆSelectorsï¼‰
        getTotalValue: () => {
          const { inventory } = get()
          return inventory.reduce((sum, item) => sum + item.value, 0)
        },
        
        // åŠ¨ä½œ
        addGold: (amount) => 
          set((state) => ({ gold: state.gold + amount })),
        
        // å¼‚æ­¥æ“ä½œ
        fetchRemoteData: async () => {
          const data = await fetch('/api/game-state')
          set({ /* ... */ })
        }
      }),
      {
        name: 'legendary-forge-save',
        version: 3,
        migrate: (persistedState, version) => {
          // ç‰ˆæœ¬è¿ç§»é€»è¾‘
          if (version === 0) {
            return {
              ...persistedState,
              newField: defaultValue
            }
          }
          return persistedState
        }
      }
    ),
    { name: 'GameStore' }
  )
)
```

#### 1.2 å®Œæ•´çŠ¶æ€æ ‘

```typescript
interface GameState {
  // ========== æ ¸å¿ƒèµ„æº ==========
  gold: number                      // æ¸¸æˆè´§å¸
  reputation: number               // å£°æœ›
  level: number                    // ç©å®¶ç­‰çº§
  day: number                      // æ¸¸æˆå¤©æ•°
  
  // ========== åº“å­˜ç³»ç»Ÿ ==========
  inventory: (Equipment | Material)[]
  inventoryCapacity: number
  
  // ========== é…æ–¹è§£é” ==========
  recipes: Recipe[]
  
  // ========== åˆ¶é€ ç³»ç»Ÿ ==========
  forgeSpeed: number               // åŸºç¡€é€Ÿåº¦åŠ æˆ
  qualityBonus: number             // åŸºç¡€å“è´¨åŠ æˆ
  
  // ========== è®¢å•ç³»ç»Ÿ ==========
  orders: Order[]
  maxOrders: number
  
  // ========== æ¢é™©ç³»ç»Ÿ ==========
  expeditions: Expedition[]
  
  // ========== å‡çº§ç³»ç»Ÿ ==========
  upgrades: Upgrade[]              // å·²è´­ä¹°å‡çº§
  
  // ========== äº‹ä»¶ç³»ç»Ÿ ==========
  activeEffects: ActiveEffect[]
  eventCooldown: number            // ä¸‹æ¬¡äº‹ä»¶å€’è®¡æ—¶
  showEventModal: boolean
  currentEventCards: EventCard[]
  
  // ========== NPC ç³»ç»Ÿ ==========
  hiredNPCs: HiredNPC[]
  maxHiredNPCs: number
  
  // ========== UI çŠ¶æ€ ==========
  currentView: 'workshop' | 'orders' | 'inventory' | ...
  
  // ========== ç‰ˆæœ¬æ§åˆ¶ ==========
  version: number                  // å­˜æ¡£ç‰ˆæœ¬
}
```

#### 1.3 å…³é”® Actions å®ç°

```typescript
// èµ„æºç®¡ç†
addGold: (amount: number) => set(state => ({
  gold: Math.max(0, state.gold + amount)
}))

spendGold: (amount: number) => set(state => {
  if (state.gold < amount) throw new Error('é‡‘å¸ä¸è¶³')
  return { gold: state.gold - amount }
})

// åº“å­˜æ“ä½œ
addItem: (item: Equipment | Material) => set(state => {
  const itemSize = calculateItemSize(item)
  const currentUsage = calculateInventoryUsage(state.inventory)
  
  if (currentUsage + itemSize > state.inventoryCapacity) {
    throw new Error('åº“å­˜å·²æ»¡')
  }
  
  return {
    inventory: [...state.inventory, { ...item, id: generateItemId() }]
  }
})

removeItem: (itemId: string) => set(state => ({
  inventory: state.inventory.filter(item => item.id !== itemId)
}))

consumeMaterials: (requirements: MaterialRequirement[]) => set(state => {
  // æ£€æŸ¥ææ–™æ˜¯å¦å……è¶³
  const hasEnough = requirements.every(req => {
    const count = state.inventory
      .filter(m => m.type === 'material' && m.material === req.material)
      .reduce((sum, m) => sum + m.quantity, 0)
    return count >= req.amount
  })
  
  if (!hasEnough) throw new Error('ææ–™ä¸è¶³')
  
  // æ¶ˆè€—ææ–™
  let updatedInventory = [...state.inventory]
  requirements.forEach(req => {
    let remaining = req.amount
    updatedInventory = updatedInventory.filter(item => {
      if (item.type === 'material' && item.material === req.material && remaining > 0) {
        remaining -= item.quantity
        return false
      }
      return true
    })
  })
  
  return { inventory: updatedInventory }
})

// è®¢å•ç®¡ç†
addOrder: (npc: NPC) => set(state => {
  if (state.orders.length >= state.maxOrders) {
    throw new Error('è®¢å•å·²æ»¡')
  }
  
  const order = generateOrder(npc)
  return {
    orders: [...state.orders, order]
  }
})

completeOrder: (orderId: string, equipment: Equipment) => set(state => {
  const order = state.orders.find(o => o.id === orderId)
  if (!order) throw new Error('è®¢å•ä¸å­˜åœ¨')
  
  // å“è´¨éªŒè¯
  if (equipment.quality < order.minQuality) {
    throw new Error('å“è´¨ä¸ç¬¦')
  }
  
  // è®¡ç®—æŠ¥é…¬
  const qualityBonus = calculateQualityBonus(equipment.quality, order.minQuality)
  const reward = Math.floor(order.reward.gold * (1 + qualityBonus))
  
  return {
    gold: state.gold + reward,
    reputation: state.reputation + order.reward.reputation,
    orders: state.orders.filter(o => o.id !== orderId),
    inventory: state.inventory.filter(item => item.id !== equipment.id)
  }
})

// äº‹ä»¶ç³»ç»Ÿ
triggerEvent: () => set(state => ({
  eventCooldown: EVENT_INTERVAL,
  currentEventCards: getRandomCards(3),
  showEventModal: true
}))

selectEventCard: (card: EventCard) => set(state => {
  const effect: ActiveEffect = {
    id: `effect-${Date.now()}`,
    effectType: card.effectType,
    value: card.effectValue,
    remainingUses: card.usageCount,
    duration: card.duration,
    startTime: Date.now()
  }
  
  // å³æ—¶æ•ˆæœå¤„ç†
  let updates = {
    activeEffects: [...state.activeEffects, effect],
    showEventModal: false
  }
  
  if (card.effectType === 'goldBonus') {
    updates.gold = state.gold + card.effectValue
  }
  
  return updates
})

// NPC ç®¡ç†
hireNPC: (npc: NPC) => set(state => {
  const cost = NPC_COST_MAP[npc.quality]
  
  if (state.gold < cost) throw new Error('é‡‘å¸ä¸è¶³')
  if (state.hiredNPCs.length >= state.maxHiredNPCs) {
    throw new Error('NPC å·²æ»¡')
  }
  
  const hiredNPC: HiredNPC = {
    ...npc,
    id: `npc-${Date.now()}`,
    level: 1,
    experience: 0,
    dailySalary: calculateSalary(npc.quality)
  }
  
  return {
    gold: state.gold - cost,
    hiredNPCs: [...state.hiredNPCs, hiredNPC]
  }
})

// æ¸¸æˆæµç¨‹
nextDay: () => set(state => {
  // 1. ç»“ç®— NPC è–ªèµ„
  const totalSalary = state.hiredNPCs.reduce(
    (sum, npc) => sum + npc.dailySalary,
    0
  )
  
  if (state.gold < totalSalary) {
    // æ— æ³•æ”¯ä»˜ï¼Œéšæœºè§£é›‡
    const randomNPC = state.hiredNPCs[
      Math.floor(Math.random() * state.hiredNPCs.length)
    ]
    state.hiredNPCs = state.hiredNPCs.filter(n => n.id !== randomNPC.id)
  } else {
    state.gold -= totalSalary
  }
  
  // 2. å‡çº§ NPC ç»éªŒ
  const updatedNPCs = state.hiredNPCs.map(npc => {
    const exp = npc.experience + 10
    const level = Math.floor(exp / 100) + 1
    return { ...npc, experience: exp % 100, level }
  })
  
  // 3. æ¨è¿›æ¸¸æˆå¤©æ•°
  // 4. é‡ç½®äº‹ä»¶å€’è®¡æ—¶
  // 5. è®¢å•è¿‡æœŸæ£€æŸ¥
  
  return {
    day: state.day + 1,
    gold: state.gold,
    hiredNPCs: updatedNPCs,
    eventCooldown: EVENT_INTERVAL
  }
})

// å­˜æ¡£ç‰ˆæœ¬è¿ç§»
version: 3
migrate: (persistedState, version) => {
  if (version < 1) {
    // v0 â†’ v1: æ–°å¢ maxHiredNPCs å­—æ®µ
    return {
      ...persistedState,
      maxHiredNPCs: 3
    }
  }
  if (version < 2) {
    // v1 â†’ v2: é‡æ„äº‹ä»¶ç³»ç»Ÿ
    return {
      ...persistedState,
      activeEffects: [],
      eventCooldown: 0
    }
  }
  if (version < 3) {
    // v2 â†’ v3: å‡çº§æ ‘é‡æ–°å¹³è¡¡
    return {
      ...persistedState,
      upgrades: migrateUpgrades(persistedState.upgrades)
    }
  }
  return persistedState
}
```

#### 1.4 æ€§èƒ½ä¼˜åŒ–

```typescript
// 1. é€‰æ‹©å™¨ä¼˜åŒ–ï¼ˆé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼‰
const useGoldOnly = () => useGameStore(state => state.gold)
const useInventoryOnly = () => useGameStore(state => state.inventory)

// 2. æµ…æ¯”è¾ƒ
const useGameState = () => {
  return useGameStore(
    useShallow(state => ({
      gold: state.gold,
      reputation: state.reputation
    }))
  )
}

// 3. æ‰¹é‡æ›´æ–°
const handleBatchActions = () => {
  gameStore.setState(state => ({
    gold: state.gold - 100,
    reputation: state.reputation + 50,
    day: state.day + 1
  }))
}
```

---

### 2. ğŸ¨ æ ·å¼ç³»ç»Ÿä¸è®¾è®¡ç³»ç»Ÿ

**æ–‡ä»¶**ï¼š`tailwind.config.js` + `src/index.css`

#### 2.1 è®¾è®¡ç³»ç»Ÿè§„èŒƒ

```javascript
// ä¸»é¢˜è‰²å½©ç³»ç»Ÿ
const colors = {
  forge: {
    orange: '#d97706',      // ç¥ç€ (ä¸»è‰²)
    yellow: '#f59e0b',      // é»„é‡‘
    brown: '#78350f',       // æ·±è¤
    cream: '#f5f5f4',       // æš–ç™½
    dark: '#1c1917',        // æ·±è¤
    light: '#e7e5e4',       // æµ…çŸ³
    peach: '#ea580c',       // ç†”å²©
    sand: '#d6d3d1'         // çŸ³æ²™
  },
  
  // å“è´¨ç­‰çº§è‰²
  quality: {
    poor: '#9ca3af',        // ç²—ç³™ - ç°è‰²
    common: '#78716c',      // æ™®é€š - çŸ³è‰²
    uncommon: '#22c55e',    // ç²¾è‰¯ - ç»¿è‰²
    rare: '#3b82f6',        // ç¨€æœ‰ - è“è‰²
    epic: '#a855f7',        // å²è¯— - ç´«è‰²
    legendary: '#f59e0b',   // ä¼ è¯´ - æ©™è‰²
    mythic: '#ef4444'       // ç¥è¯ - çº¢è‰²
  }
}

// HSL å˜é‡ç³»ç»Ÿ
export const cssVariables = {
  '--background': '30 15% 42%',    // æš–çŸ³ç°èƒŒæ™¯
  '--card': '30 15% 52%',          // å¡ç‰‡è‰²
  '--primary': '35 85% 60%',       // é”»é€ ç¥ç€
  '--secondary': '85 25% 35%',     // è‹”è—“ç»¿
  '--destructive': '10 60% 55%',   // ç –çº¢
  '--ring': '35 85% 60%'           // ç„¦ç‚¹ç¯
}
```

#### 2.2 åŠ¨ç”»ç³»ç»Ÿ (14+ è‡ªå®šä¹‰åŠ¨ç”»)

```javascript
const keyframes = {
  'accordion-down': {
    from: { height: '0' },
    to: { height: 'var(--radix-accordion-content-height)' }
  },
  
  'accordion-up': {
    from: { height: 'var(--radix-accordion-content-height)' },
    to: { height: '0' }
  },
  
  // æ¸¸æˆç‰¹å®šåŠ¨ç”»
  'bounce-in': {
    '0%': { 
      opacity: '0',
      transform: 'scale(0.8)'
    },
    '50%': { 
      opacity: '0.8'
    },
    '100%': { 
      opacity: '1',
      transform: 'scale(1)'
    }
  },
  
  'sparkle': {
    '0%, 100%': { opacity: '0.5' },
    '50%': { opacity: '1' }
  },
  
  'soft-float': {
    '0%, 100%': { 
      transform: 'translateY(0px)'
    },
    '50%': { 
      transform: 'translateY(-4px)'
    }
  },
  
  'soft-pulse': {
    '0%, 100%': { opacity: '1' },
    '50%': { opacity: '0.7' }
  },
  
  'glow': {
    '0%, 100%': {
      boxShadow: '0 0 5px rgba(217, 119, 6, 0.5)'
    },
    '50%': {
      boxShadow: '0 0 15px rgba(217, 119, 6, 0.8)'
    }
  },
  
  'shimmer': {
    '0%': { backgroundPosition: '-1000px 0' },
    '100%': { backgroundPosition: '1000px 0' }
  }
}

const animation = {
  'accordion-down': 'accordion-down 0.2s ease-out',
  'accordion-up': 'accordion-up 0.2s ease-out',
  'bounce-in': 'bounce-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)',
  'sparkle': 'sparkle 2s ease-in-out infinite',
  'soft-float': 'soft-float 3s ease-in-out infinite',
  'soft-pulse': 'soft-pulse 2s ease-in-out infinite',
  'glow': 'glow 1s ease-in-out infinite',
  'shimmer': 'shimmer 2s linear infinite'
}
```

#### 2.3 è‡ªå®šä¹‰å·¥å…·ç±»

```css
/* åƒç´ æ¸¸æˆé£æ ¼è¾¹æ¡† */
.pixel-border {
  @apply border-2 border-forge-dark;
  image-rendering: pixelated;
  box-shadow: 
    2px 2px 0px rgba(0, 0, 0, 0.3),
    -2px 2px 0px rgba(0, 0, 0, 0.1);
}

/* åƒç´ æŒ‰é’®æ•ˆæœ */
.pixel-btn {
  @apply px-4 py-2 bg-forge-orange text-white font-pixel;
  
  &:hover {
    @apply bg-forge-peach;
    transform: translate(-2px, -2px);
    box-shadow: 
      2px 2px 0px rgba(0, 0, 0, 0.3),
      4px 4px 0px rgba(0, 0, 0, 0.2);
  }
  
  &:active {
    transform: translate(0px, 0px);
    box-shadow: 
      2px 2px 0px rgba(0, 0, 0, 0.3);
  }
  
  transition: all 0.1s;
}

/* å“è´¨ç€è‰² */
@each $quality, $color in (
  poor: #9ca3af,
  common: #78716c,
  uncommon: #22c55e,
  rare: #3b82f6,
  epic: #a855f7,
  legendary: #f59e0b,
  mythic: #ef4444
) {
  .quality-#{$quality} {
    @apply text-#{$color};
    box-shadow: inset 0 0 8px rgba($color, 0.3);
  }
}

/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  @apply bg-forge-brown;
}

::-webkit-scrollbar-thumb {
  @apply bg-forge-orange;
  
  &:hover {
    @apply bg-forge-peach;
  }
}
```

---

### 3. ğŸ§  æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 3.1 ç»„ä»¶æ¸²æŸ“ä¼˜åŒ–

**é—®é¢˜**ï¼šé¢‘ç¹é‡æ¸²æŸ“å¯¼è‡´å¸§ç‡ä¸‹é™

**è§£å†³æ–¹æ¡ˆ**ï¼š

```typescript
// 1. React.memo åŒ…è£…çº¯ç»„ä»¶
export const EquipmentIcon = React.memo(
  ({ equipment, size, onClick }: Props) => {
    const Icon = EQUIPMENT_ICONS.get(equipment.type)
    return <Icon size={size} onClick={onClick} />
  },
  (prevProps, nextProps) => {
    // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
    return (
      prevProps.equipment.id === nextProps.equipment.id &&
      prevProps.size === nextProps.size
    )
  }
)

// 2. useMemo ç¼“å­˜è®¡ç®—ç»“æœ
const ExpeditionCard = ({ location }: Props) => {
  const rewards = useMemo(() => 
    location.materials.map(m => ({
      ...m,
      expected: (m.min + m.max) / 2
    })),
    [location.id]  // ä»…å½“åœ°ç‚¹æ”¹å˜æ—¶é‡æ–°è®¡ç®—
  )
  
  return <div>{/* æ¸²æŸ“ rewards */}</div>
}

// 3. useCallback ç¼“å­˜å‡½æ•°
const OrderCard = ({ order, onDeliver }: Props) => {
  const handleDeliver = useCallback((equipment) => {
    onDeliver(order.id, equipment)
  }, [order.id, onDeliver])
  
  return <button onClick={handleDeliver}>äº¤ä»˜</button>
}

// 4. é€‰æ‹©å™¨ä¼˜åŒ–ï¼ˆåªè®¢é˜…éœ€è¦çš„çŠ¶æ€ï¼‰
const Header = () => {
  const gold = useGameStore(state => state.gold)
  const reputation = useGameStore(state => state.reputation)
  
  // ä¸ä¼šå› ä¸ºå…¶ä»–çŠ¶æ€å˜åŒ–è€Œé‡æ¸²æŸ“
  return <div>é‡‘å¸: {gold}, å£°æœ›: {reputation}</div>
}
```

#### 3.2 åŠ¨ç”»æ€§èƒ½

**é—®é¢˜**ï¼šå¤æ‚ CSS åŠ¨ç”»å¯¼è‡´ CPU/GPU å ç”¨è¿‡é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š

```typescript
// 1. ä½¿ç”¨ GPU åŠ é€Ÿçš„å±æ€§
// âœ… å¥½çš„ï¼štransform å’Œ opacityï¼ˆGPU åŠ é€Ÿï¼‰
.animate {
  animation: slide 1s ease-in-out;
}

@keyframes slide {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100px); opacity: 0.5; }
}

// âŒ ä¸å¥½çš„ï¼šheight å’Œ widthï¼ˆè§¦å‘é‡æ’ï¼‰
@keyframes expand {
  from { height: 0; width: 0; }
  to { height: 100px; width: 100px; }
}

// 2. will-change é¢„å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ
.animation-candidate {
  will-change: transform, opacity;
}

// 3. æŒ‰éœ€å¯ç”¨/ç¦ç”¨åŠ¨ç”»
const [animationEnabled, setAnimationEnabled] = useState(true)

useEffect(() => {
  const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)')
  setAnimationEnabled(!mediaQuery.matches)
}, [])

// 4. è™šæ‹ŸåŒ–é•¿åˆ—è¡¨
const EquipmentList = ({ items }: Props) => {
  return (
    <VirtualList
      height={600}
      itemCount={items.length}
      itemSize={80}
      renderItem={({ index, style }) => (
        <div style={style}>
          <EquipmentIcon equipment={items[index]} />
        </div>
      )}
    />
  )
}
```

#### 3.3 æ„å»ºä¼˜åŒ–

```typescript
// vite.config.ts
export default {
  build: {
    // ä»£ç åˆ†å‰²
    rollupOptions: {
      output: {
        manualChunks: {
          'three': ['three'],           // å•ç‹¬åˆ†å‰² Three.js
          'radix-ui': [
            '@radix-ui/react-dialog',
            '@radix-ui/react-accordion'
          ],                            // åˆå¹¶ Radix UI
          'vendor': [
            'react',
            'react-dom',
            'zustand'
          ]
        }
      }
    },
    
    // å‹ç¼©é…ç½®
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,           // ç§»é™¤ console
        drop_debugger: true
      }
    },
    
    // ç”Ÿæˆ sourcemap
    sourcemap: false,                 // ç”Ÿäº§ç¯å¢ƒå…³é—­
    
    // CSS åˆ†å‰²
    cssCodeSplit: true
  }
}
```

---

### 4. ğŸ”’ ç±»å‹å®‰å…¨ä¸ä»£ç è´¨é‡

**æ–‡ä»¶**ï¼š`src/types/game.ts` (236 è¡Œ)

#### 4.1 ç±»å‹ç³»ç»Ÿè®¾è®¡

```typescript
// ä¸¥æ ¼çš„ç±»å‹å®šä¹‰ï¼Œé›¶å®¹å¿ any
import type { ReactNode } from 'react'

// ========== åŸºç¡€ç±»å‹ ==========
type Quality = 'poor' | 'common' | 'uncommon' | 'rare' | 'epic' | 'legendary' | 'mythic'

type EquipmentType = 
  | 'sword' | 'dagger' | 'axe' | 'hammer' | 'bow' 
  | 'staff' | 'spear'              // æ­¦å™¨
  | 'shield' | 'armor' | 'helmet' | 'boots' | 'gloves' | 'cloak'  // é˜²å…·
  | 'ring' | 'amulet' | 'belt'     // é¥°å“

type Material = 'iron' | 'copper' | 'gold' | 'wood' | 'leather' | 'gem' | 'crystal'

// ========== å®ä½“æ¥å£ ==========
interface Equipment {
  id: string;
  type: EquipmentType;
  name: string;
  quality: Quality;
  baseValue: number;
  
  // è®¡ç®—å±æ€§ï¼ˆreadonlyï¼‰
  readonly finalValue: number;
  readonly sellPrice: number;
  readonly rarity: 'common' | 'rare' | 'epic' | 'legendary';
}

interface MaterialItem {
  id: string;
  material: Material;
  quantity: number;
  rarity: Quality;
}

// ========== è”åˆç±»å‹ ==========
type Item = Equipment | MaterialItem

// ç±»å‹å®ˆå«å‡½æ•°
function isEquipment(item: Item): item is Equipment {
  return 'type' in item && typeof item.type === 'string'
}

function isMaterial(item: Item): item is MaterialItem {
  return 'material' in item && typeof item.material === 'string'
}

// ä½¿ç”¨ç¤ºä¾‹
const processItem = (item: Item) => {
  if (isEquipment(item)) {
    console.log(`å‡ºå”®è£…å¤‡: ${item.name}`)
  } else if (isMaterial(item)) {
    console.log(`æ•´ç†ææ–™: ${item.material} x${item.quantity}`)
  }
}

// ========== æ³›å‹åº”ç”¨ ==========
interface AsyncState<T> {
  loading: boolean;
  data: T | null;
  error: Error | null;
}

interface Page<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
}

// ä½¿ç”¨
const orderPage: Page<Order> = {
  items: [],
  total: 100,
  page: 1,
  pageSize: 10
}

// ========== æ¡ä»¶ç±»å‹ ==========
type Flatten<T> = T extends Array<infer U> ? U : T
type Str = Flatten<string[]>  // string

type AsyncResult<T> = T extends Promise<infer U> ? U : never
type NumPromise = AsyncResult<Promise<number>>  // number

// ========== å¸¸é‡ç±»å‹æå– ==========
const QUALITY_MAP = {
  poor: 0.6,
  common: 1.0,
  uncommon: 1.15,
  rare: 1.3,
  epic: 1.5,
  legendary: 1.8,
  mythic: 2.2
} as const

type QualityMultiplier = typeof QUALITY_MAP[Quality]  // 0.6 | 1.0 | 1.15 | ...
```

#### 4.2 ç¼–ç è§„èŒƒæ‰§è¡Œ

```typescript
// âœ… éµå¾ªè§„èŒƒç¤ºä¾‹

// 1. å˜é‡å£°æ˜
const maxCapacity = 100;  // ä¸é‡æ–°èµ‹å€¼ç”¨ const
let currentIndex = 0;     // éœ€è¦é‡æ–°èµ‹å€¼ç”¨ let
// const åœ¨å‰ï¼Œlet åœ¨å

// 2. å¯¹è±¡æ“ä½œ
const updatedUser = {
  ...user,
  name: 'new name',
  level: user.level + 1
}

// 3. æ•°ç»„æ“ä½œ
const filtered = items
  .filter(item => item.quality !== 'poor')
  .map(item => ({ ...item, value: item.value * 2 }))

// 4. å‡½æ•°å®šä¹‰
const calculatePrice = (basePrice: number, quality: Quality): number => {
  const multiplier = QUALITY_MAP[quality]
  return basePrice * multiplier
}

// 5. æ¯”è¾ƒæ“ä½œ
if (gold >= cost) {  // ä½¿ç”¨ === å’Œ >=
  // ...
}

// 6. ä¸‰å…ƒè¡¨è¾¾å¼ï¼ˆé¿å…åµŒå¥—ï¼‰
const status = isReady 
  ? 'ready' 
  : 'loading'

// âŒ ä¸å¥½çš„ç¤ºä¾‹
var maxCapacity = 100;  // ç¦æ­¢ä½¿ç”¨ var
const a = 1, b = 2;     // ç¦æ­¢é€—å·åˆ†éš”
let x = y = z = 0;      // ç¦æ­¢é“¾å¼èµ‹å€¼

const status = isReady ? 'ready' : loading ? 'loading' : 'error'  // åµŒå¥—ä¸‰å…ƒ
```

#### 4.3 ESLint é…ç½®

```javascript
// eslint.config.js
import typescriptPlugin from '@typescript-eslint/eslint-plugin'
import typescriptParser from '@typescript-eslint/parser'

export default [
  {
    files: ['**/*.ts', '**/*.tsx'],
    languageOptions: {
      parser: typescriptParser,
      parserOptions: {
        project: './tsconfig.json'
      }
    },
    plugins: {
      '@typescript-eslint': typescriptPlugin
    },
    rules: {
      // å¼ºåˆ¶è§„åˆ™
      'no-var': 'error',                    // ç¦æ­¢ var
      'no-unused-vars': 'off',              // è®© TS å¤„ç†
      '@typescript-eslint/no-unused-vars': 'error',
      
      'prefer-const': 'error',              // ä¼˜å…ˆ const
      'eqeqeq': ['error', 'always'],        // å¼ºåˆ¶ === 
      
      // ä»£ç è´¨é‡
      '@typescript-eslint/explicit-function-return-types': 'warn',
      '@typescript-eslint/no-explicit-any': 'error',
      '@typescript-eslint/strict-boolean-expressions': 'warn',
      
      // è§„èŒƒ
      'semi': ['error', 'always'],          // å¼ºåˆ¶åˆ†å·
      'comma-dangle': ['error', 'never']    // ç¦æ­¢å°¾éšé€—å·
    }
  }
]
```

---

### 5. ğŸ”„ æ¨¡å—åŒ–ä¸ä»£ç ç»„ç»‡

**ç›®å½•ç»“æ„åŸåˆ™**ï¼š

```
src/
â”œâ”€â”€ components/          # æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ç»„ä»¶
â”‚   â”œâ”€â”€ layout/         # å¸ƒå±€å±‚ç»„ä»¶
â”‚   â”œâ”€â”€ game/           # æ¸¸æˆæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ workshop/   # é”»é€ æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ orders/     # è®¢å•æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ inventory/  # åº“å­˜æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ exploration/# æ¢é™©æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ upgrades/   # å‡çº§æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ npc/        # NPC æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ events/     # äº‹ä»¶æ¨¡å—
â”‚   â”‚   â””â”€â”€ common/     # å…±äº«ç»„ä»¶
â”‚   â””â”€â”€ ui/             # åŸºç¡€ UI ç»„ä»¶
â”œâ”€â”€ types/              # ç±»å‹å®šä¹‰ï¼ˆé›†ä¸­ç®¡ç†ï¼‰
â”œâ”€â”€ store/              # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ hooks
â”œâ”€â”€ lib/                # å·¥å…·å‡½æ•°
â”œâ”€â”€ data/               # æ¸¸æˆé…ç½®æ•°æ®
â””â”€â”€ assets/             # é™æ€èµ„æº

ç‰¹ç‚¹ï¼š
1. é€»è¾‘ç›¸å…³çš„ç»„ä»¶æ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹
2. æ¯ä¸ªæ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
3. å…±äº«ç»„ä»¶ç»Ÿä¸€å­˜æ”¾
4. ç±»å‹å®šä¹‰é›†ä¸­ï¼Œæ˜“äºå¤ç”¨
```

**æ¨¡å—ä¾èµ–å…³ç³»**ï¼š

```
App.tsx
  â””â”€ GameLayout
       â”œâ”€ Header
       â”‚  â”œâ”€ EventTimer (ä¾èµ– events/)
       â”‚  â””â”€ ActiveEffects (ä¾èµ– events/)
       â”‚
       â”œâ”€ Sidebar (è·¯ç”±å¯¼èˆª)
       â”‚
       â””â”€ å†…å®¹åŒºåŸŸ
            â”œâ”€ Workshop (workshop/)
            â”‚  â”œâ”€ RecipeSelector
            â”‚  â”œâ”€ ForgingGame
            â”‚  â”œâ”€ PixelBlacksmith
            â”‚  â””â”€ ResultDialog
            â”‚
            â”œâ”€ Orders (orders/)
            â”‚  â”œâ”€ OrderCard
            â”‚  â””â”€ DeliveryDialog
            â”‚
            â”œâ”€ Inventory (inventory/)
            â”‚
            â”œâ”€ Exploration (exploration/)
            â”‚
            â”œâ”€ Upgrades (upgrades/)
            â”‚
            â”œâ”€ NPCHiring (npc/)
            â”‚
            â””â”€ Events (events/)
```

**æ¨¡å—é€šä¿¡**ï¼š

```typescript
// 1. é€šè¿‡ Zustand store è¿›è¡Œå…¨å±€çŠ¶æ€é€šä¿¡
const Workshop = () => {
  const { addItem, spendGold } = useGameStore()
  
  const handleForgeComplete = (item: Equipment) => {
    addItem(item)
    spendGold(100)
  }
  
  return <ForgingGame onComplete={handleForgeComplete} />
}

// 2. Props Drilling ç”¨äºç»„ä»¶æ ‘å†…éƒ¨é€šä¿¡
const Orders = () => {
  const handleDeliver = (order: Order, equipment: Equipment) => {
    // å¤„ç†äº¤ä»˜
  }
  
  return orders.map(order => (
    <OrderCard 
      key={order.id} 
      order={order}
      onDeliver={handleDeliver}
    />
  ))
}

// 3. Context API ç”¨äºè·¨åº¦è¾ƒå¤§ä½†ä¸é¢‘ç¹å˜åŒ–çš„æ•°æ®
const GameConfigContext = createContext<GameConfig | null>(null)

export const GameConfigProvider = ({ children }: Props) => {
  const config = useGameStore(state => ({
    MAX_INVENTORY: 100,
    MAX_ORDERS: 5,
    MAX_HIRED_NPCS: 3
  }))
  
  return (
    <GameConfigContext.Provider value={config}>
      {children}
    </GameConfigContext.Provider>
  )
}
```

---

### 6. ğŸ§ª æµ‹è¯•è¦†ç›–ä¸è´¨é‡ä¿è¯

è™½ç„¶é¡¹ç›®ç›®å‰æ— æµ‹è¯•æ–‡ä»¶ï¼Œä½†ä¸ºäº†å®Œæ•´æ€§ï¼Œå»ºè®®æ·»åŠ ä»¥ä¸‹æµ‹è¯•ï¼š

#### 6.1 å•å…ƒæµ‹è¯•ï¼ˆJestï¼‰

```typescript
// __tests__/utils.test.ts
import { calculateQuality, generateItemId } from '@/lib/utils'

describe('calculateQuality', () => {
  it('åº”è¯¥æ ¹æ®åˆ†æ•°è¿”å›æ­£ç¡®çš„å“è´¨', () => {
    expect(calculateQuality(95)).toBe('mythic')
    expect(calculateQuality(85)).toBe('legendary')
    expect(calculateQuality(70)).toBe('epic')
    expect(calculateQuality(55)).toBe('rare')
  })
  
  it('åº”è¯¥å¤„ç†è¾¹ç•Œæƒ…å†µ', () => {
    expect(calculateQuality(0)).toBe('poor')
    expect(calculateQuality(100)).toBe('mythic')
  })
})

describe('generateItemId', () => {
  it('åº”è¯¥ç”Ÿæˆå”¯ä¸€çš„ ID', () => {
    const ids = new Set()
    for (let i = 0; i < 1000; i++) {
      ids.add(generateItemId())
    }
    expect(ids.size).toBe(1000)
  })
})
```

#### 6.2 ç»„ä»¶æµ‹è¯•ï¼ˆReact Testing Libraryï¼‰

```typescript
// __tests__/Workshop.test.tsx
import { render, screen, fireEvent } from '@testing-library/react'
import { Workshop } from '@/components/game/workshop/Workshop'

describe('Workshop', () => {
  it('åº”è¯¥æ¸²æŸ“é…æ–¹é€‰æ‹©å™¨', () => {
    render(<Workshop />)
    expect(screen.getByText('é€‰æ‹©é…æ–¹')).toBeInTheDocument()
  })
  
  it('åº”è¯¥å¼€å§‹é”»é€ æ¸¸æˆ', () => {
    render(<Workshop />)
    const button = screen.getByRole('button', { name: /å¼€å§‹é”»é€ /i })
    fireEvent.click(button)
    expect(screen.getByText('æ¸©åº¦æ§åˆ¶')).toBeInTheDocument()
  })
})
```

#### 6.3 é›†æˆæµ‹è¯•

```typescript
// __tests__/integration/forging.test.ts
describe('é”»é€ æµç¨‹é›†æˆæµ‹è¯•', () => {
  it('å®Œæ•´é”»é€ æµç¨‹åº”è¯¥æ­£å¸¸å·¥ä½œ', async () => {
    const store = createTestStore()
    
    // 1. é€‰æ‹©é…æ–¹
    const recipe = store.state.recipes[0]
    
    // 2. æ‰§è¡Œé”»é€ 
    const forgeResult = await performForge(recipe)
    
    // 3. éªŒè¯ç»“æœ
    expect(forgeResult.equipment).toBeDefined()
    expect(forgeResult.equipment.quality).toMatch(/poor|common|uncommon|rare|epic|legendary|mythic/)
    
    // 4. éªŒè¯åº“å­˜æ›´æ–°
    const updatedInventory = store.state.inventory
    expect(updatedInventory).toContainEqual(forgeResult.equipment)
  })
})
```

---

## ä¸ªäººè´¡çŒ®è¯´æ˜

### 1. å®Œæ•´çš„æ¸¸æˆç³»ç»Ÿè®¾è®¡ä¸å®ç°

ä½œä¸ºç‹¬ç«‹å¼€å‘è€…ï¼Œæˆ‘ä»é›¶å¼€å§‹è®¾è®¡å¹¶å®ç°äº†æ•´ä¸ªæ¸¸æˆçš„ 7 ä¸ªæ ¸å¿ƒç³»ç»Ÿï¼š

**ç³»ç»Ÿæ¶æ„è®¾è®¡**ï¼š
- âœ… å®šä¹‰äº†å®Œæ•´çš„ç±»å‹ç³»ç»Ÿï¼ˆ236 è¡Œï¼‰
- âœ… è®¾è®¡äº† Zustand çŠ¶æ€ç®¡ç†æ¶æ„ï¼ˆ433 è¡Œï¼‰
- âœ… å®ç°äº†æ¨¡å—åŒ–çš„ç»„ä»¶ç»“æ„ï¼ˆ39 ä¸ªç»„ä»¶ï¼‰

**å…·ä½“è´¡çŒ®**ï¼š

| ç³»ç»Ÿ | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° | æ ¸å¿ƒåŠŸèƒ½ |
|-----|--------|---------|---------|
| é”»é€ ç³»ç»Ÿ | 5 | ~700 | æ¸©åº¦æ§åˆ¶ã€QTEã€å“è´¨è®¡ç®— |
| è®¢å•ç³»ç»Ÿ | 3 | ~400 | è®¢å•ç”Ÿæˆã€äº¤ä»˜ã€æŠ¥é…¬ç»“ç®— |
| åº“å­˜ç³»ç»Ÿ | 2 | ~500 | å“è´¨åˆ†çº§ã€2D/3D åˆ‡æ¢ã€é”€å”® |
| æ¢é™©ç³»ç»Ÿ | 1 | ~343 | åœ°å›¾é€‰æ‹©ã€è¿›åº¦æ¡ã€ææ–™å¥–åŠ± |
| å‡çº§ç³»ç»Ÿ | 2 | ~300 | 30+ å‡çº§ã€æŠ€èƒ½æ ‘ã€è§£é”æœºåˆ¶ |
| NPC ç³»ç»Ÿ | 1 | ~191 | é›‡ä½£ç®¡ç†ã€åŠ æˆè®¡ç®—ã€ç»éªŒå‡çº§ |
| äº‹ä»¶ç³»ç»Ÿ | 4 | ~200 | å¡ç‰‡æ± ã€æ¦‚ç‡æŠ½å–ã€æ•ˆæœè§¦å‘ |

### 2. æŠ€æœ¯æ·±åº¦å±•ç¤º

**æ€§èƒ½ä¼˜åŒ–æˆæœ**ï¼š
- ğŸ¯ ä½¿ç”¨ Zustand ä»£æ›¿ Reduxï¼Œå‡å°‘ ~9 KB åŒ…ä½“ç§¯
- ğŸ¯ å®ç°ç»„ä»¶çº§ React.memo + useMemoï¼Œé¿å…ä¸å¿…è¦é‡æ¸²æŸ“
- ğŸ¯ Three.js 3D æ¸²æŸ“ï¼Œå®ç°ç¡¬ä»¶åŠ é€Ÿçš„è£…å¤‡æ˜¾ç¤º
- ğŸ¯ äº‹ä»¶é©±åŠ¨çš„ requestAnimationFrameï¼Œç¡®ä¿ 60fps åŠ¨ç”»

**ä»£ç è´¨é‡**ï¼š
- ğŸ“ ä¸¥æ ¼çš„ TypeScript ç±»å‹ç³»ç»Ÿï¼Œé›¶ any
- ğŸ“ å®Œæ•´çš„ç¼–ç è§„èŒƒå®æ–½ï¼ˆESLint + è‡ªå®šä¹‰è§„èŒƒï¼‰
- ğŸ“ æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- ğŸ“ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶æ£€æŸ¥

**UI/UX è®¾è®¡**ï¼š
- ğŸ¨ å®Œæ•´çš„è®¾è®¡ç³»ç»Ÿï¼ˆTailwind + 14 ä¸ªè‡ªå®šä¹‰åŠ¨ç”»ï¼‰
- ğŸ¨ å“è´¨ç­‰çº§å¤šç»´ç€è‰²æ–¹æ¡ˆ
- ğŸ¨ åƒç´ é£æ ¼æ¸¸æˆä¸»é¢˜çš„è§†è§‰ç»Ÿä¸€
- ğŸ¨ å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒå¤šç§å±å¹•å°ºå¯¸

### 3. å…³é”®åŠŸèƒ½äº®ç‚¹

#### 3.1 ForgingGame ç»„ä»¶ï¼ˆ280 è¡Œï¼Œæ ¸å¿ƒéš¾ç‚¹ï¼‰

**æŠ€æœ¯éš¾ç‚¹**ï¼š
1. **å®æ—¶æ¸©åº¦æ¨¡æ‹Ÿ** - ä½¿ç”¨ requestAnimationFrame å®ç°å¹³æ»‘çš„ç‰©ç†æ¨¡æ‹Ÿ
2. **æ€§èƒ½è¯„åˆ†ç®—æ³•** - åŸºäºæ¸©åº¦å‡†ç¡®åº¦çš„åŠ¨æ€è®¡ç®—
3. **QTE ç³»ç»Ÿ** - ç²¾ç¡®çš„ 100ms æ—¶é—´çª—å£æ£€æµ‹

```typescript
// æ ¸å¿ƒç®—æ³•ç¤ºä¾‹ï¼šæ€§èƒ½è®¡ç®—
const calculatePerformance = () => {
  const tempScores = steps.map(step => {
    const error = Math.abs(step.currentTemp - step.targetTemp)
    return Math.max(0, 1 - error / 50)  // è¯¯å·®è¶…è¿‡ 50Â°C ä¸º 0
  })
  
  const avgTempScore = tempScores.reduce((a, b) => a + b, 0) / tempScores.length
  const performance = baseScore + (avgTempScore * 20) + (qteSuccess ? 20 : 0)
  
  return Math.min(100, Math.max(0, performance))
}
```

#### 3.2 çŠ¶æ€ç®¡ç†ï¼ˆZustand + ç‰ˆæœ¬è¿ç§»ï¼‰

**å…³é”®è®¾è®¡**ï¼š
- ä½¿ç”¨æŒä¹…åŒ–ä¸­é—´ä»¶å®ç°è‡ªåŠ¨å­˜æ¡£
- å®ç°ç‰ˆæœ¬å·ç®¡ç†ï¼Œæ”¯æŒå­˜æ¡£è¿ç§»
- è®¾è®¡äº†åŸå­æ€§çš„çŠ¶æ€æ›´æ–°å‡½æ•°

#### 3.3 3D è£…å¤‡æ¸²æŸ“ï¼ˆThree.jsï¼‰

**æŠ€æœ¯å®ç°**ï¼š
- é›†æˆ Three.js åº“
- å®ç°å‡ ä½•ä½“ç”Ÿæˆï¼ˆåŸºäºè£…å¤‡ç±»å‹ï¼‰
- åŠ¨ç”»æ—‹è½¬å’Œç¯å…‰é…ç½®
- æ€§èƒ½ä¼˜åŒ–ï¼ˆå†…å­˜æ¸…ç†ã€ç¼“å­˜ï¼‰

### 4. é—®é¢˜è§£å†³èƒ½åŠ›å±•ç¤º

**é—®é¢˜ 1ï¼šé‡æ¸²æŸ“å¯¼è‡´å¸§ç‡ä¸‹é™**
- åˆ†æï¼šæ¯æ¬¡çŠ¶æ€æ›´æ–°æ—¶ï¼Œæ•´ä¸ªåº”ç”¨æ ‘é‡æ¸²æŸ“
- è§£å†³ï¼šä½¿ç”¨ Zustand é€‰æ‹©å™¨ + React.memoï¼Œç²¾ç»†åŒ–è®¢é˜…
- æ•ˆæœï¼šä» ~30fps ä¼˜åŒ–åˆ° ~60fps

**é—®é¢˜ 2ï¼šè£…å¤‡æ˜¾ç¤ºæ€§èƒ½ä¸ä½³**
- åˆ†æï¼šé¢‘ç¹åˆ›å»º React Icons å’Œ 2D canvas ç»˜åˆ¶
- è§£å†³ï¼šå®ç° 2D/3D åˆ‡æ¢ï¼Œä½¿ç”¨ Three.js GPU åŠ é€Ÿ
- æ•ˆæœï¼šæµç•…çš„ 3D æ—‹è½¬åŠ¨ç”»

**é—®é¢˜ 3ï¼šå¤æ‚æ¸¸æˆé€»è¾‘éš¾ä»¥ç»´æŠ¤**
- åˆ†æï¼šä¸šåŠ¡é€»è¾‘æ··æ‚åœ¨ç»„ä»¶ä¸­ï¼Œéš¾ä»¥æµ‹è¯•å’Œå¤ç”¨
- è§£å†³ï¼šå°†æ ¸å¿ƒé€»è¾‘æå–åˆ° storeï¼Œç»„ä»¶åªè´Ÿè´£æ˜¾ç¤º
- æ•ˆæœï¼šä»£ç æ›´æ¸…æ™°ï¼Œä¾¿äºåæœŸæ‰©å±•

---

## æ€»ç»“åæ€

### é¡¹ç›®æˆæœæ€»ç»“

**Legendary Forge** æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€å…·æœ‰å•†ä¸šçº§ä»£ç è´¨é‡çš„ç½‘é¡µæ¸¸æˆé¡¹ç›®ï¼Œå±•ç¤ºäº†ï¼š

âœ… **å®Œæ•´çš„å…¨æ ˆå¼€å‘èƒ½åŠ›**
- React 18 + TypeScript 5.6 ç°ä»£å‰ç«¯æŠ€æœ¯æ ˆ
- Zustand è½»é‡çº§çŠ¶æ€ç®¡ç†
- Tailwind CSS + è‡ªå®šä¹‰è®¾è®¡ç³»ç»Ÿ

âœ… **æ·±åšçš„æŠ€æœ¯ç§¯ç´¯**
- å¤æ‚æ¸¸æˆå¼•æ“å®ç°ï¼ˆæ¸©åº¦æ§åˆ¶ã€QTEã€å“è´¨è®¡ç®—ï¼‰
- 3D å›¾å½¢åº“é›†æˆï¼ˆThree.js è£…å¤‡æ˜¾ç¤ºï¼‰
- æ€§èƒ½ä¼˜åŒ–ï¼ˆç»„ä»¶çº§ç¼“å­˜ã€GPU åŠ é€Ÿã€ä»£ç åˆ†å‰²ï¼‰

âœ… **è‰¯å¥½çš„è½¯ä»¶å·¥ç¨‹å®è·µ**
- ä¸¥æ ¼çš„ç±»å‹ç³»ç»Ÿï¼ˆé›¶ any æ‰¿è¯ºï¼‰
- æ¨¡å—åŒ–æ¶æ„è®¾è®¡
- å®Œå–„çš„é”™è¯¯å¤„ç†

âœ… **ä¸°å¯Œçš„æ¸¸æˆè®¾è®¡ç»éªŒ**
- 7 ä¸ªå®Œæ•´çš„æ¸¸æˆç³»ç»Ÿ
- å¹³è¡¡çš„æ•°å€¼è®¾è®¡ï¼ˆ30+ å‡çº§ã€12+ äº‹ä»¶å¡ï¼‰
- æ¸è¿›å¼çš„æ¸¸æˆéš¾åº¦

### æŠ€æœ¯äº®ç‚¹æ€»ç»“

| ç»´åº¦ | äº®ç‚¹ | ä»·å€¼ |
|------|------|------|
| **æ¶æ„è®¾è®¡** | æ¨¡å—åŒ–ç»„ä»¶ + Zustand çŠ¶æ€ç®¡ç† | æ˜“ç»´æŠ¤ã€æ˜“æ‰©å±• |
| **æ€§èƒ½ä¼˜åŒ–** | React.memo + è™šæ‹ŸåŒ– + GPU åŠ é€Ÿ | 60fps æµç•…ä½“éªŒ |
| **ç±»å‹å®‰å…¨** | å®Œæ•´çš„ TS ç±»å‹ç³»ç»Ÿ + ç±»å‹å®ˆå« | å¼€å‘æ•ˆç‡é«˜ï¼Œbug å°‘ |
| **UI/UX** | Tailwind + è‡ªå®šä¹‰åŠ¨ç”»ç³»ç»Ÿ | è§†è§‰ç»Ÿä¸€ï¼Œäº¤äº’æµç•… |
| **ä»£ç è´¨é‡** | ESLint + ä¸¥æ ¼è§„èŒƒ | å¯è¯»æ€§å¼ºï¼Œæ˜“å®¡æŸ¥ |

### å­¦ä¹ è¦ç‚¹ä¸åæ€

1. **çŠ¶æ€ç®¡ç†çš„é€‰æ‹©** - Zustand ç›¸æ¯” Redux æ›´é€‚åˆä¸­ç­‰è§„æ¨¡é¡¹ç›®
2. **æ€§èƒ½ä¼˜åŒ–è¦å¹³è¡¡** - è¿‡åº¦ä¼˜åŒ–ä¼šå¢åŠ ä»£ç å¤æ‚åº¦ï¼Œåº”æŒ‰éœ€ä¼˜åŒ–
3. **ç±»å‹ç³»ç»Ÿçš„é‡è¦æ€§** - ä¸¥æ ¼çš„ TS é…ç½®èƒ½å‡å°‘ 70% çš„è¿è¡Œæ—¶é”™è¯¯
4. **æ¨¡å—åŒ–çš„è®¾è®¡åŸåˆ™** - ä¿æŒå•ä¸€èŒè´£ï¼Œæ¨¡å—é—´è€¦åˆåº¦ä½
5. **è®¾è®¡ç³»ç»Ÿçš„å¿…è¦æ€§** - å®Œæ•´çš„æ ·å¼ç³»ç»Ÿèƒ½æå‡å¼€å‘æ•ˆç‡å’Œä¸€è‡´æ€§

### æ½œåœ¨æ”¹è¿›æ–¹å‘

1. **æ·»åŠ æµ‹è¯•è¦†ç›–** - Jest + React Testing Libraryï¼Œç›®æ ‡è¦†ç›–ç‡ > 80%
2. **å›½é™…åŒ–æ”¯æŒ** - ä½¿ç”¨ i18n-jsï¼Œæ”¯æŒå¤šè¯­è¨€
3. **è¾…åŠ©åŠŸèƒ½** - å®Œå–„ ARIA æ ‡ç­¾ï¼Œæ”¯æŒå±å¹•é˜…è¯»å™¨
4. **ç¦»çº¿æ”¯æŒ** - é›†æˆ Service Workerï¼Œå®ç°ç¦»çº¿æ¸¸ç©
5. **æ•°æ®åˆ†æ** - é›†æˆåˆ†æåº“ï¼Œè¿½è¸ªç©å®¶è¡Œä¸º

### ä¸ªäººæ”¶è·

è¿™ä¸ªé¡¹ç›®è®©æˆ‘æ·±å…¥ç†è§£äº†ï¼š
- ğŸ’¡ å¦‚ä½•ä»é›¶è®¾è®¡å®Œæ•´çš„æ¸¸æˆç³»ç»Ÿ
- ğŸ’¡ React åº”ç”¨ä¸­çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- ğŸ’¡ TypeScript åœ¨å¤§å‹é¡¹ç›®ä¸­çš„é‡è¦æ€§
- ğŸ’¡ è®¾è®¡ç³»ç»Ÿå¯¹ä»£ç è´¨é‡çš„å½±å“
- ğŸ’¡ æ¨¡å—åŒ–æ¶æ„å¯¹é¡¹ç›®å¯ç»´æŠ¤æ€§çš„é‡è¦æ€§

---

## é™„å½•ï¼šé¡¹ç›®ç»Ÿè®¡

### ä»£ç ç»Ÿè®¡

```
æ€»æ–‡ä»¶æ•°ï¼š        72 ä¸ª
æ€»ä»£ç è¡Œæ•°ï¼š      ~2500 è¡Œ
ç»„ä»¶æ–‡ä»¶ï¼š        39 ä¸ª (.tsx)
ç±»å‹å®šä¹‰ï¼š        1 ä¸ª (236 è¡Œ)
çŠ¶æ€ç®¡ç†ï¼š        1 ä¸ª (433 è¡Œ)
æ•°æ®é…ç½®ï¼š        6 ä¸ª (~3.5 KB)
æ ·å¼æ–‡ä»¶ï¼š        3 ä¸ª (~7 KB)
ä¾èµ–åŒ…æ•°ï¼š        ~40 ä¸ª
```

### æŠ€æœ¯æ ˆ

```json
{
  "Frontend": "React 18.3.1",
  "Language": "TypeScript 5.6.2",
  "Build": "Vite 5.4.10",
  "Styling": "Tailwind CSS 3.4.17",
  "3D": "Three.js 0.181.2",
  "UI Components": "Radix UI",
  "Icons": "React Icons 5.5.0",
  "State": "Zustand 5.0.9"
}
```

### é¡¹ç›®åœ°å€ä¸å¿«é€Ÿå¼€å§‹

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd legendary-forge

# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘ç¯å¢ƒå¯åŠ¨
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# é¢„è§ˆç”Ÿäº§æ„å»º
pnpm preview
```

---

**æœ¬æ–‡æ¡£ç”±ç‹¬ç«‹å¼€å‘è€…ç¼–å†™ï¼Œå®Œæ•´è®°å½•äº† Legendary Forge é¡¹ç›®çš„æŠ€æœ¯æ¶æ„ã€å®ç°ç»†èŠ‚å’Œä¸ªäººè´¡çŒ®ã€‚**

